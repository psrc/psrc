- content_for :meta do
  %script{:type=>"text/javascript"}
    :plain
      var last_type = "";
      function load_tag_reference(part) {
        page_type = $F('page_class_name');
        popup = $('tag-reference-popup');
        if(last_type != page_type) {
          url = "/admin/ui/pages/tag_reference";
          params = "class_name=" + page_type;
          new Effect.Highlight('tag-reference-link-'+ part);
          req = new Ajax.Request(url, {method: 'get', parameters: params, evalScripts: true});
        } else {
          center(popup);
          Element.toggle(popup);
        }
        return false;
      }
      var last_filter = "";
      function load_filter_reference(part) {
        filter_type = $F("part_" + part + "_filter_id");
        popup = $('filter-reference-popup');
        if(last_filter != filter_type) {
          url = "/admin/ui/pages/filter_reference";
          params = "filter_name=" + filter_type;
          new Effect.Highlight('filter-reference-link-'+ part);
          req = new Ajax.Request(url, {method: 'get', parameters: params, evalScripts: true});
        } else {
          center(popup);
          Element.toggle(popup);
        }
        return false;
      }
  
  %style{:type=>"text/css", :media=>"screen"}
    :sass
      #content
        #extended-metadata
          .fieldset
            margin-left: 0
            margin-right: 0
            margin-bottom: .5em
            padding: 0
            td.label
              text-align: left
              width: 15%
              .textbox
                width: 90%

%input#page_lock_version{:name=>"page[lock_version]", :type=>"hidden", :value=>"0"}/
.form-area
  %p.title
    %label{:for=>"page_title"}
      Page Title
    %input#page_title.textbox{:name=>"page[title]", :size=>"255", :type=>"text", :maxlength=>"255"}/
  #extended-metadata.row{:style=>"display: none"}
    %table.fieldset
      %tr
        %td.label
          %label{:for=>"page_slug"}
            Slug
        %td.field
          %input#page_slug.textbox{:name=>"page[slug]", :size=>"100", :type=>"text", :value=>"/", :maxlength=>"100"}/
      %tr
        %td.label
          %label{:for=>"page_breadcrumb"}
            Breadcrumb
        %td.field
          %input#page_breadcrumb.textbox{:name=>"page[breadcrumb]", :size=>"160", :type=>"text", :value=>"Home", :maxlength=>"160"}/
  %p.more-or-less
    %small
      %a#more-extended-metadata{:href=>"#", :onclick=>"Element.toggle('extended-metadata'); Element.toggle('more-extended-metadata'); Element.toggle('less-extended-metadata'); return false"}
        More
      %a#less-extended-metadata{:href=>"#", :onclick=>"Element.toggle('extended-metadata'); Element.toggle('more-extended-metadata'); Element.toggle('less-extended-metadata'); return false", :style=>"display: none"}
        Less
  #tab-control
    #tabs.tabs
      #tab-toolbar
        %a{:href=>"#", :title=>"Add Tab", :onclick=>"toggle_add_part_popup(); return false;"}
          %img{:src=>"/admin/images/plus.png?1202263271", :alt=>"Plus"}/
        %a{:href=>"#", :title=>"Remove Tab", :onclick=>"if(confirm('Delete the current tab?')) {tabControl.removeTab(tabControl.selected)}; return false;"}
          %img{:src=>"/admin/images/minus.png?1202263271", :alt=>"Minus"}/
    #pages.pages
      #page-1.page
        #part-1.part
          %input#part_0_name{:name=>"part[0][name]", :type=>"hidden", :value=>"body"}/
          %p
            %label{:for=>"part_0_filter_id"} Filter
            %select#part_0_filter_id{:name=>"part[0][filter_id]"}
              %option{:value=>""} &lt;none&gt;
              %option{:value=>"Markdown"} Markdown
              %option{:value=>"SmartyPants"} SmartyPants
              %option{:value=>"Textile"} Textile
            %span#reference-links
              Reference:
              %span#filter-reference-link-0
                %a{:href=>"#", :onclick=>"load_filter_reference(0); return false;"} Filter
              %span#tag-reference-link-0
                %a{:href=>"#", :onclick=>"load_tag_reference(0); return false;"} Available Tags
          %div
            %textarea#part_0_content.textarea{:name=>"part[0][content]", :style=>"width: 100%"}=""
      #page-2.page
        #part-2.part
          %input#part_1_name{:name=>"part[1][name]", :type=>"hidden", :value=>"sidebar"}/
          %p
            %label{:for=>"part_1_filter_id"}
              Filter
            %select#part_1_filter_id{:name=>"part[1][filter_id]"}
              %option{:value=>""} &lt;none&gt;
              %option{:value=>"Markdown"} Markdown
              %option{:value=>"SmartyPants"} SmartyPants
              %option{:value=>"Textile"} Textile
            %span#reference-links
              Reference:
              %span#filter-reference-link-1
                %a{:href=>"#", :onclick=>"load_filter_reference(1); return false;"} Filter
              %span#tag-reference-link-1
                %a{:href=>"#", :onclick=>"load_tag_reference(1); return false;"} Available Tags
          %div
            %textarea#part_1_content.textarea{:name=>"part[1][content]", :style=>"width: 100%"}=""
  .row
    %p
      %label{:for=>"page_layout_id"}
        Layout
      %select#page_layout_id{:name=>"page[layout_id]"}
        %option{:value=>""} &lt;inherit&gt;
        %option{:selected=>"selected", :value=>"1"} Normal
        %option{:value=>"2"} Stylesheet
        %option{:value=>"3"} XML Feed
    %p
      %label{:for=>"page_class_name"}
        Page Type
      %select#page_class_name{:name=>"page[class_name]"}
        %option{:value=>"Page"}
          <normal>
        %option{:value=>"ArchivePage"}
          Archive
        %option{:value=>"ArchiveDayIndexPage"}
          Archive Day Index
        %option{:value=>"ArchiveMonthIndexPage"}
          Archive Month Index
        %option{:value=>"ArchiveYearIndexPage"}
          Archive Year Index
        %option{:value=>"EnvDumpPage"}
          Env Dump
        %option{:value=>"FileNotFoundPage"}
          File Not Found
    %p
      %label{:for=>"page_status_id"}
        Status
      %select#page_status_id{:name=>"page[status_id]"}
        %option{:value=>"1"}
          Draft
        %option{:value=>"50"}
          Reviewed
        %option{:selected=>"selected", :value=>"100"}
          Published
        %option{:value=>"101"}
          Hidden
  %span.clear &nbsp;
  %p{:style=>"clear: left"}
    %small
      Last updated by admin at 02:26
      %small AM
      on February 22, 2008

- content_for :popups do
  #add-part-popup.popup{:style=>"display: none"}
    #busy.busy{:style=>"display: none"}
      %img{:src=>"/admin/images/spinner.gif?1202263271", :alt=>"Spinner"}/
    %h3
      Add Part
    %form{:action=>"/admin/ui/pages/part/add", :method=>"post", :onsubmit=>"if (valid_part_name()) {new Ajax.Updater('pages', '/admin/ui/pages/part/add', {asynchronous:true, evalScripts:true, insertion:Insertion.Bottom, onComplete:function(request){part_added()}, onLoading:function(request){part_loading()}, parameters:Form.serialize(this)});}; return false;"}
      %div
        %input#part-index-field{:name=>"index", :type=>"hidden", :value=>"2"}/
        %input#part-name-field{:name=>"part[name]", :type=>"text", :value=>"", :maxlength=>"100"}/
        %input#add-part-button{:name=>"commit", :type=>"submit", :value=>"Add Part"}/
      %p
        %a.close-link{:href=>"#", :onclick=>"$(this).up('.popup').hide(); return false;"}
          Close